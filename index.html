<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Gerador de Arte GeomÃ©trica</title>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary: #8b5cf6;
Â  Â  Â  Â  Â  Â  --accent: #38bdf8;
Â  Â  Â  Â  Â  Â  --success: #22c55e;
Â  Â  Â  Â  Â  Â  --danger: #ef4444;
Â  Â  Â  Â  Â  Â  --dark: #0f172a;
Â  Â  Â  Â  Â  Â  --panel: #1e293b;
Â  Â  Â  Â  Â  Â  --text: #f8fafc;
Â  Â  Â  Â  Â  Â  --border: #334155;
Â  Â  Â  Â  Â  Â  --disabled: #475569;
Â  Â  Â  Â  }

Â  Â  Â  Â  * { box-sizing: border-box; user-select: none; }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', system-ui, sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--dark);
Â  Â  Â  Â  Â  Â  color: var(--text);
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  height: 50px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  padding: 0 20px;
Â  Â  Â  Â  Â  Â  background: rgba(15, 23, 42, 0.95);
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--border);
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {Â 
Â  Â  Â  Â  Â  Â  font-size: 1.2rem; margin: 0;Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(to right, #c084fc, #38bdf8);Â 
Â  Â  Â  Â  Â  Â  -webkit-background-clip: text; -webkit-text-fill-color: transparent;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  .app-container {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 260px 1fr;
Â  Â  Â  Â  Â  Â  height: calc(100vh - 50px);
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }

Â  Â  Â  Â  .sidebar {
Â  Â  Â  Â  Â  Â  background: var(--panel);
Â  Â  Â  Â  Â  Â  border-right: 1px solid var(--border);
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .panel-section h3 { margin: 0 0 10px 0; font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }

Â  Â  Â  Â  .sidebar-shapes {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .shape-option {
Â  Â  Â  Â  Â  Â  background: #334155;
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .shape-option:hover { background: #475569; }
Â  Â  Â  Â  .shape-option input { margin: 0; accent-color: var(--accent); cursor: pointer; }

Â  Â  Â  Â  .workspace {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  Â  Â  background: #020617;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .canvas-area {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  min-height: 0;
Â  Â  Â  Â  Â  Â  background: #000;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  border: 1px dashed var(--border);
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  .canvas-area:fullscreen {
Â  Â  Â  Â  Â  Â  border: none; border-radius: 0; width: 100vw; height: 100vh;
Â  Â  Â  Â  Â  Â  background: #000; display: flex; align-items: center; justify-content: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  #btnExitFS {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 20px;
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  width: 40px;
Â  Â  Â  Â  Â  Â  height: 40px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  background: rgba(239, 68, 68, 0.9);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: 2px solid rgba(255,255,255,0.2);
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  z-index: 9999;
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  transition: opacity 0.3s ease, transform 0.2s;
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
Â  Â  Â  Â  }

Â  Â  Â  Â  #btnExitFS:hover {
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  transform: scale(1.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  .canvas-area:not(:fullscreen) #btnExitFS {
Â  Â  Â  Â  Â  Â  display: none !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  canvas {
Â  Â  Â  Â  Â  Â  max-width: 100%; max-height: 100%; aspect-ratio: 16/9;
Â  Â  Â  Â  Â  Â  object-fit: contain; box-shadow: 0 0 40px rgba(0,0,0,0.6);
Â  Â  Â  Â  }

Â  Â  Â  Â  .controls-bar {
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  background: var(--panel);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border);
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr auto 1fr 1fr auto auto;
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  Â  Â  margin-bottom: 60px;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  width: 100%; padding: 10px; border: none; border-radius: 6px;
Â  Â  Â  Â  Â  Â  font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 0.85rem;
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center; gap: 8px; color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn:hover { filter: brightness(1.15); transform: translateY(-1px); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-search { background: linear-gradient(135deg, #0ea5e9, #6366f1); }
Â  Â  Â  Â  .btn-random { background: #f59e0b; color: #fff; }Â 
Â  Â  Â  Â  .btn-upload { background: #334155; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-action { background: #334155; height: 100%; font-size: 1.2rem; width: 50px; }
Â  Â  Â  Â  .btn-dl { background: #10b981; }
Â  Â  Â  Â  .btn-fs { background: #6366f1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-toggle { background: #334155; color: #cbd5e1; border: 1px solid var(--border); }
Â  Â  Â  Â  .btn-toggle.active { background: var(--success); color: #000; border-color: var(--success); box-shadow: 0 0 10px rgba(34, 197, 94, 0.4); }

Â  Â  Â  Â  .btn-trend {Â 
Â  Â  Â  Â  Â  Â  background: rgba(255,255,255,0.03); color: #cbd5e1;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border); text-align: left; padding: 8px;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.8rem; display: flex; justify-content: space-between;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-trend:hover { border-color: var(--accent); background: rgba(255,255,255,0.08); }

Â  Â  Â  Â  .control-group { display: flex; flex-direction: column; gap: 4px; transition: opacity 0.3s; }
Â  Â  Â  Â  .control-group.disabled { opacity: 0.3; pointer-events: none; filter: grayscale(1); }
Â  Â  Â  Â  .control-label { font-size: 0.75rem; color: #94a3b8; display: flex; justify-content: space-between; }
Â  Â  Â  Â  input[type=range] { width: 100%; accent-color: var(--primary); height: 4px; cursor: pointer; }
Â  Â  Â  Â  select { background: #0f172a; border: 1px solid var(--border); color: white; padding: 4px; border-radius: 4px; width: 100%; font-size: 0.85rem;}

Â  Â  Â  Â  .status-overlay {
Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; justify-content: center; align-items: center;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.9); z-index: 10;
Â  Â  Â  Â  }
Â  Â  Â  Â  .status-text { background: #1e293b; padding: 15px 25px; border-radius: 8px; color: #f1f5f9; border: 1px solid var(--border); text-align: center; }
Â  Â  Â  Â  .loader {
Â  Â  Â  Â  Â  Â  width: 40px; height: 40px; border: 4px solid #FFF; border-bottom-color: var(--accent);
Â  Â  Â  Â  Â  Â  border-radius: 50%; animation: rotation 1s linear infinite; margin-bottom: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

Â  Â  Â  Â  #searchPanel { display: none; background: #0f172a; padding: 10px; border-radius: 6px; border: 1px solid var(--accent); margin-bottom: 5px; }
Â  Â  Â  Â  #searchInput { width: 100%; background: transparent; border: 1px solid var(--border); color: white; padding: 8px; margin-bottom: 8px; font-size: 0.9rem;}

Â  Â  </style>
</head>
<body>

Â  Â  <header class="header">
Â  Â  Â  Â  <h1>Gerador de Arte GeomÃ©trica</h1>
Â  Â  Â  Â  <div style="font-size: 0.8rem; color: #64748b;">AplicaÃ§Ã£o Web</div>
Â  Â  </header>

Â  Â  <div class="app-container">
Â  Â  Â  Â  <aside class="sidebar">
Â  Â  Â  Â  Â  Â  <div class="panel-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Fontes de Imagem</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnRandom" class="btn btn-random" style="margin-bottom: 8px;">ğŸ² AleatÃ³ria</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnToggleSearch" class="btn btn-search" style="margin-bottom: 8px;">ğŸ” Pesquisar Tema</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="searchPanel">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="searchInput" placeholder="Ex: Gato, Praia, Neon...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnDoSearch" class="btn" style="background:var(--accent); color:#000; padding: 5px;">Buscar Foto</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="btn btn-upload">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“‚ Upload Arquivo
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="fileInput" hidden accept="image/*">
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <hr style="border:0; border-top:1px solid var(--border); width: 100%;">
Â  Â  Â  Â  Â  Â  <div class="panel-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Formas GeomÃ©tricas</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="sidebar-shapes" id="shapesContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="shape-option"><input type="checkbox" value="circle" checked> CÃ­rculos</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="shape-option"><input type="checkbox" value="square" checked> Quadrados</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="shape-option"><input type="checkbox" value="triangle"> TriÃ¢ngulos</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="shape-option"><input type="checkbox" value="line"> Linhas</label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <hr style="border:0; border-top:1px solid var(--border); width: 100%;">
Â  Â  Â  Â  Â  Â  <div class="panel-section" style="flex: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ”¥ SugestÃµes</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="trendingList" style="display: flex; flex-direction: column; gap: 6px;"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </aside>

Â  Â  Â  Â  <main class="workspace">
Â  Â  Â  Â  Â  Â  <div class="canvas-area" id="canvasContainer">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnExitFS" title="Sair da Tela Cheia">âœ•</button>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="status-overlay" id="statusOverlay">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="loader" id="loader"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="status-text" id="statusText">Escolha uma opÃ§Ã£o Ã  esquerda para comeÃ§ar</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="artCanvas"></canvas>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="controls-bar">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-label">â±ï¸ DuraÃ§Ã£o</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="timeSelect">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="15000">15 Segundos</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="30000" selected>30 Segundos</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="60000">1 Minuto</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="120000">2 Minutos</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="180000">3 Minutos</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="240000">4 Minutos</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnDetailMode" class="btn btn-toggle active" title="Controla o tamanho automaticamente">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ¨ Modo AutomÃ¡tico
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 0.7em;">LIGADO</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-label">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸš€ Velocidade</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="speedVal">Auto</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="speedSlider" min="1" max="50" value="40">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-group disabled" id="abstractionGroup">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-label">ğŸ¨ Escala</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="abstractionSlider" min="1" max="100" value="50">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnFullscreen" class="btn btn-action btn-fs" title="Tela Cheia">â›¶</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnDownload" class="btn btn-action btn-dl" title="Salvar Arte">ğŸ’¾</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  const config = { width: 1920, height: 1080, shapes: ['circle', 'square'], abstraction: 50, paintSpeed: 40, duration: 30000, isRunning: false, startTime: 0, currentMode: 'none', currentTag: '', evolutionMode: true };
Â  Â  Â  Â  const canvas = document.getElementById('artCanvas');
Â  Â  Â  Â  const ctx = canvas.getContext('2d', { willReadFrequently: true });
Â  Â  Â  Â  let sourceData = null, animationFrameId = null, originalImg = null;

Â  Â  Â  Â  function init() { canvas.width = config.width; canvas.height = config.height; generateTrending(); updateDetailBtnUI(); }

Â  Â  Â  Â  function generateTrending() {
Â  Â  Â  Â  Â  Â  const themes = [ { name: "Cyberpunk", tag: "cyberpunk,neon", color: "#22d3ee" }, { name: "Natureza", tag: "forest,nature", color: "#4ade80" }, { name: "Retrato", tag: "portrait,face", color: "#f472b6" }, { name: "EspaÃ§o", tag: "galaxy,nebula", color: "#818cf8" }, { name: "Arquitetura", tag: "architecture,city", color: "#fb923c" } ];
Â  Â  Â  Â  Â  Â  const container = document.getElementById('trendingList'); container.innerHTML = '';
Â  Â  Â  Â  Â  Â  themes.forEach((item, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.createElement('button'); btn.className = 'btn btn-trend';
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = `<span>#${i+1} ${item.name}</span> <span style="color:${item.color};">TOCAR</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  btn.onclick = () => { config.currentMode = 'search'; config.currentTag = item.tag; searchImage(item.tag); };
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(btn);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function searchImage(keyword) { config.currentMode = 'search'; config.currentTag = keyword; loadImage(`https://loremflickr.com/1920/1080/${encodeURIComponent(keyword)}`, 0); }

Â  Â  Â  Â  function setLoading(isLoading, text) {
Â  Â  Â  Â  Â  Â  const el = document.getElementById('statusOverlay');
Â  Â  Â  Â  Â  Â  if(isLoading) { el.style.display = 'flex'; document.getElementById('statusText').innerText = text; document.getElementById('loader').style.display = 'block'; } else { el.style.display = 'none'; }
Â  Â  Â  Â  }

Â  Â  Â  Â  function loadImage(baseUrl, attempt) {
Â  Â  Â  Â  Â  Â  if (attempt === 0) setLoading(true, "Processando..."); config.isRunning = false; if(animationFrameId) cancelAnimationFrame(animationFrameId);
Â  Â  Â  Â  Â  Â  const img = new Image(); img.crossOrigin = "Anonymous";Â 
Â  Â  Â  Â  Â  Â  img.onload = () => { originalImg = img; startArt(); setLoading(false); };
Â  Â  Â  Â  Â  Â  img.onerror = () => { if (attempt < 5) setTimeout(() => loadImage(baseUrl, attempt + 1), 1500); else { setLoading(true, "Erro ao carregar recurso."); setTimeout(nextImage, 1000); } };
Â  Â  Â  Â  Â  Â  img.src = baseUrl.startsWith('data:') ? baseUrl : `${baseUrl.split('?')[0]}?random=${Date.now()}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function nextImage() { if (config.currentMode === 'search') searchImage(config.currentTag); else if (config.currentMode === 'random') document.getElementById('btnRandom').click(); else if (config.currentMode === 'upload') startArt(); }

Â  Â  Â  Â  function startArt() {
Â  Â  Â  Â  Â  Â  const offCanvas = document.createElement('canvas'); offCanvas.width = config.width; offCanvas.height = config.height;
Â  Â  Â  Â  Â  Â  const offCtx = offCanvas.getContext('2d'); drawImageCover(offCtx, originalImg, config.width, config.height);
Â  Â  Â  Â  Â  Â  try { sourceData = offCtx.getImageData(0, 0, config.width, config.height).data; } catch(e) { setLoading(true, "Erro de SeguranÃ§a (CORS)."); return; }
Â  Â  Â  Â  Â  Â  ctx.fillStyle = "#111111"; ctx.fillRect(0, 0, config.width, config.height);
Â  Â  Â  Â  Â  Â  config.startTime = Date.now(); config.isRunning = true; loop();
Â  Â  Â  Â  }

Â  Â  Â  Â  function loop() {
Â  Â  Â  Â  Â  Â  if(!config.isRunning) return;
Â  Â  Â  Â  Â  Â  const elapsed = Date.now() - config.startTime; const duration = parseInt(config.duration);
Â  Â  Â  Â  Â  Â  if(elapsed > duration) { nextImage(); return; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const progress = Math.min(elapsed / duration, 1.0);
Â  Â  Â  Â  Â  Â  let currentBaseSize = 40, loopsThisFrame = 1;

Â  Â  Â  Â  Â  Â  if (config.evolutionMode) {
Â  Â  Â  Â  Â  Â  Â  Â  const shrinkLimit = duration >= 120000 ? 0.4 : 0.6;
Â  Â  Â  Â  Â  Â  Â  Â  let sizeProgress = progress / shrinkLimit; if (sizeProgress > 1) sizeProgress = 1;
Â  Â  Â  Â  Â  Â  Â  Â  currentBaseSize = 40 * (3.5 * (1 - sizeProgress) + 0.1 * sizeProgress);
Â  Â  Â  Â  Â  Â  Â  Â  loopsThisFrame = Math.floor((config.paintSpeed / 10) * Math.pow(150 / currentBaseSize, 1.5) * 0.5);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  currentBaseSize = map(config.abstraction, 1, 100, 5, 80); loopsThisFrame = config.paintSpeed;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (currentBaseSize < 2) currentBaseSize = 2; if (loopsThisFrame < 1) loopsThisFrame = 1; if (loopsThisFrame > 600) loopsThisFrame = 600;

Â  Â  Â  Â  Â  Â  let shapesToUse = config.shapes.length > 0 ? config.shapes : ['circle'];
Â  Â  Â  Â  Â  Â  for(let i=0; i < loopsThisFrame; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const x = Math.floor(Math.random() * config.width), y = Math.floor(Math.random() * config.height);
Â  Â  Â  Â  Â  Â  Â  Â  const idx = (y * config.width + x) * 4;
Â  Â  Â  Â  Â  Â  Â  Â  if(sourceData[idx+3] < 20) continue;
Â  Â  Â  Â  Â  Â  Â  Â  const naturalJitter = 0.6 + (Math.random() * 0.8);
Â  Â  Â  Â  Â  Â  Â  Â  const finalSize = currentBaseSize * (0.8 + (sourceData[idx] + sourceData[idx+1] + sourceData[idx+2]) / 765 * 0.4) * naturalJitter;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = ctx.strokeStyle = `rgb(${sourceData[idx]},${sourceData[idx+1]},${sourceData[idx+2]})`;
Â  Â  Â  Â  Â  Â  Â  Â  drawShape(x, y, finalSize, shapesToUse[Math.floor(Math.random() * shapesToUse.length)]);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  animationFrameId = requestAnimationFrame(loop);
Â  Â  Â  Â  }

Â  Â  Â  Â  function drawShape(x, y, size, s) {
Â  Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  Â  if(s === 'circle') { ctx.arc(x, y, size/2, 0, Math.PI*2); ctx.fill(); }
Â  Â  Â  Â  Â  Â  else if(s === 'square') { ctx.save(); ctx.translate(x, y); ctx.rotate(Math.random()*Math.PI*0.2); ctx.rect(-size/2, -size/2, size, size); ctx.fill(); ctx.restore(); }
Â  Â  Â  Â  Â  Â  else if(s === 'triangle') { ctx.save(); ctx.translate(x, y); ctx.rotate(Math.random()*Math.PI*0.5); const h = size * 0.866; ctx.moveTo(0, -h/2); ctx.lineTo(-size/2, h/2); ctx.lineTo(size/2, h/2); ctx.fill(); ctx.restore(); }
Â  Â  Â  Â  Â  Â  else if(s === 'line') { ctx.lineWidth = Math.max(1, size/4); const a = Math.random()*Math.PI*2; ctx.moveTo(x-Math.cos(a)*size, y-Math.sin(a)*size); ctx.lineTo(x+Math.cos(a)*size, y+Math.sin(a)*size); ctx.stroke(); }
Â  Â  Â  Â  }

Â  Â  Â  Â  function drawImageCover(ctx, img, w, h) {
Â  Â  Â  Â  Â  Â  const r = Math.max(w / img.width, h / img.height);
Â  Â  Â  Â  Â  Â  ctx.drawImage(img, (w - img.width * r) / 2, (h - img.height * r) / 2, img.width * r, img.height * r);
Â  Â  Â  Â  }
Â  Â  Â  Â  function map(v, a, b, c, d) { return c + ((v-a)/(b-a)) * (d-c); }

Â  Â  Â  Â  document.getElementById('btnFullscreen').onclick = () => { const el = document.getElementById('canvasContainer'); el.requestFullscreen().catch(e=>{}); };
Â  Â  Â  Â  document.getElementById('btnExitFS').onclick = () => { if(document.exitFullscreen) document.exitFullscreen(); };
Â  Â  Â  Â  document.getElementById('btnDetailMode').onclick = () => { config.evolutionMode = !config.evolutionMode; updateDetailBtnUI(); };
Â  Â  Â  Â  function updateDetailBtnUI() {Â 
Â  Â  Â  Â  Â  Â  const b = document.getElementById('btnDetailMode'), g = document.getElementById('abstractionGroup');
Â  Â  Â  Â  Â  Â  if(config.evolutionMode) { b.classList.add('active'); b.querySelector('span').innerText = "LIGADO"; g.classList.add('disabled'); document.getElementById('speedVal').innerText = "Auto"; }
Â  Â  Â  Â  Â  Â  else { b.classList.remove('active'); b.querySelector('span').innerText = "DESLIGADO"; g.classList.remove('disabled'); }
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById('timeSelect').onchange = (e) => config.duration = parseInt(e.target.value);
Â  Â  Â  Â  document.getElementById('speedSlider').oninput = (e) => { config.paintSpeed = parseInt(e.target.value); if(!config.evolutionMode) document.getElementById('speedVal').innerText = config.paintSpeed > 30 ? "RÃ¡pido" : "Normal"; };
Â  Â  Â  Â  document.getElementById('abstractionSlider').oninput = (e) => config.abstraction = parseInt(e.target.value);
Â  Â  Â  Â  document.querySelectorAll('#shapesContainer input').forEach(cb => { cb.onchange = () => { config.shapes = Array.from(document.querySelectorAll('#shapesContainer input:checked')).map(c => c.value); } });
Â  Â  Â  Â  document.getElementById('btnDownload').onclick = () => { const a = document.createElement('a'); a.download = 'art.png'; a.href = canvas.toDataURL(); a.click(); };
Â  Â  Â  Â  document.getElementById('btnRandom').onclick = () => { config.currentMode = 'random'; loadImage(`https://picsum.photos/1920/1080`, 0); };
Â  Â  Â  Â  document.getElementById('btnToggleSearch').onclick = () => { const p = document.getElementById('searchPanel'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; };
Â  Â  Â  Â  document.getElementById('btnDoSearch').onclick = () => { const val = document.getElementById('searchInput').value; if(val) searchImage(val); };
Â  Â  Â  Â  document.getElementById('searchInput').onkeypress = (e) => { if(e.key === 'Enter') { const val = document.getElementById('searchInput').value; if(val) searchImage(val); } };
Â  Â  Â  Â  document.getElementById('fileInput').onchange = (e) => { const f = e.target.files[0]; if(f) { config.currentMode = 'upload'; setLoading(true, "Processando..."); const r = new FileReader(); r.onload = (evt) => loadImage(evt.target.result, 0); r.readAsDataURL(f); } };

Â  Â  Â  Â  init();
Â  Â  </script>
</body>
</html>
